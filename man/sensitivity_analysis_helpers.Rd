% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sensitivity_analysis.R
\name{sensitivity_analysis_helpers}
\alias{sensitivity_analysis_helpers}
\alias{make_tfr_surfs_arg_list}
\alias{make_alt_surfs_output_dir_list}
\alias{make_alt_surfs_filenames}
\alias{make_alt_surfs_variant_comparison_table_filename}
\alias{make_alt_surfs}
\alias{make_alt_surfs.list}
\alias{make_alt_surfs.tfr_surfs_args_list}
\alias{get_rds_filepath}
\alias{make_alt_surfs_db_tables}
\alias{make_alt_surfs_db_tables.list}
\alias{make_alt_surfs_db_tables.character}
\alias{make_alt_surfs_stats_tables}
\alias{make_alt_surfs_stats_tables.list}
\alias{make_alt_surfs_stats_tables.character}
\alias{make_alt_surfs_variant_comparison_df}
\alias{make_alt_surfs_variant_comparison_table}
\alias{make_alt_surfs_periods_tables}
\alias{make_alt_surfs_periods_tables.list}
\alias{make_alt_surfs_periods_tables.character}
\alias{make_alt_surfs_plots}
\alias{make_alt_surfs_plots.list}
\alias{make_alt_surfs_plots.character}
\title{Sensitivity analysis helper functions}
\usage{
make_tfr_surfs_arg_list(
  id = "default",
  desc = "Default",
  sim.dir = getOption("tfrSURFs.sim.dir"),
  alt_args = NULL
)

make_alt_surfs_output_dir_list(
  alt_id,
  root_dir = getwd(),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name"),
  create = TRUE
)

make_alt_surfs_filenames(
  alt_id,
  ext = c("rds", "pdf", "csv", "xlsx"),
  median_only = FALSE,
  suff = NULL
)

make_alt_surfs_variant_comparison_table_filename(
  alt_surfs,
  median_only = FALSE,
  stat = c("count", "avg_len")
)

make_alt_surfs(x, ...)

\method{make_alt_surfs}{list}(
  x,
  ...,
  median_only = FALSE,
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name"),
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite")
)

\method{make_alt_surfs}{tfr_surfs_args_list}(
  x,
  median_only = FALSE,
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name"),
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite")
)

get_rds_filepath(
  alt_id,
  median_only = FALSE,
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name"),
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite")
)

make_alt_surfs_db_tables(x, ...)

\method{make_alt_surfs_db_tables}{list}(
  x,
  ...,
  median_only = FALSE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

\method{make_alt_surfs_db_tables}{character}(
  x,
  ...,
  median_only = FALSE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

make_alt_surfs_stats_tables(x, ...)

\method{make_alt_surfs_stats_tables}{list}(
  x,
  ...,
  median_only = FALSE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  stat = c("count", "avg_len"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

\method{make_alt_surfs_stats_tables}{character}(
  x,
  median_only = FALSE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  stat = c("count", "avg_len"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

make_alt_surfs_variant_comparison_df(
  alt_surfs,
  median_only = FALSE,
  stat = c("count", "avg_len"),
  incl_small_countries = FALSE,
  filter_zero_rows = TRUE,
  geographies = c("area_name", "reg_name", "name", "sub_saharan_africa", "global"),
  timevar = c("alt_surf", "geog"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

make_alt_surfs_variant_comparison_table(
  alt_surfs,
  median_only = FALSE,
  stat = c("count", "avg_len"),
  incl_small_countries = FALSE,
  filter_zero_rows = TRUE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

make_alt_surfs_periods_tables(x, ...)

\method{make_alt_surfs_periods_tables}{list}(
  x,
  ...,
  median_only = FALSE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  table_type = c("concise", "surfs only", "detailed"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

\method{make_alt_surfs_periods_tables}{character}(
  x,
  median_only = FALSE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  table_type = c("concise", "surfs only", "detailed"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

make_alt_surfs_plots(x, ...)

\method{make_alt_surfs_plots}{list}(
  x,
  file_type = c("pdf", "svg"),
  ...,
  plot_ann = NULL,
  add_median_TFR_surfs = TRUE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)

\method{make_alt_surfs_plots}{character}(
  x,
  file_type = c("pdf", "svg"),
  plot_ann = paste0("SURF Variant: ", toString(x)),
  add_median_TFR_surfs = TRUE,
  incl_small_countries = FALSE,
  overwrite = getOption("tfrSURFs.sensitivity_analysis_overwrite"),
  output_dir_name = getOption("tfrSURFs.sensitivity_analysis_output_dir_name")
)
}
\arguments{
\item{id}{Character; short ID name for the alternative SURF definition.}

\item{desc}{Character; textual description of alternative SURF definition.}

\item{sim.dir}{Directory with the MCMC simulation results; see
\code{\link{bayesTFR::get.tfr.mcmc}}.}

\item{alt_args}{List of arguments defining the alternative SURF definition.
This is passed to \code{\link{make_tfr_surfs}} so it can only contain
valid arguments to that function.}

\item{alt_id}{ID of the alternative SURF definition.}

\item{root_dir}{Root directory for the output files.}

\item{output_dir_name}{Name of the top-level output directory (exists in
\code{root_dir}.}

\item{create}{Logical; create the directories if they don't exist?}

\item{ext}{File extension}

\item{median_only}{Logical; generate results using only posterior median
TFRs as input? Filenames will have \dQuote{\file{_median}} appended.
This convention is used by other functions to identify medians-only
results.}

\item{suff}{Suffix for filename.}

\item{alt_surfs}{Either a character vector of alternative SURF definition ID
names, or a list. If the latter, the names will be taken as alternative
SURF ID names.}

\item{stat, geographies}{Passed to \code{\link{tabulate_surf_stats}}.}

\item{x}{Argument on which S3 method dispatch is performed.}

\item{overwrite}{Logical; overwrite any existing plot files.}

\item{incl_small_countries}{Logical; include countries with populations less
than 90000 in mid-2024?}

\item{timevar}{Controls how the output table is reshaped. If \code{"geog"},
the most granular of \code{geographies} is used.}

\item{plot_ann}{Text string to add to plots describing the variant.}

\item{add_median_TFR_surfs}{Logical; add the medians-only
\code{\link[=ggplot2::geom_rug]{rugs}} to the plot?}

\item{verbose}{Logical; print informational messages?}

\item{fn_suff}{Filename suffix.}

\item{alt_surfs_res_list}{List of results of running SURF variants, as
created by \code{\link{make_alt_surfs}}. If this is
\code{NULL}, the results list will be loaded from files pointed to by
\code{dir_list}.}
}
\description{
These functions are used in scripts that generate, save, and compare the
results for variations of the SURF conditions. To define a SURF variant, use
\code{make_tfr_surfs_arg_list}. It returns a list; multiple calls can be
combined to create a list of alternative SURF definitions (see
\dQuote{Examples}). Each variant is saved to its own subfolder of
\code{output_dir_name} to allow for the addition of other variants at a
later time.
}
\details{
\subsection{Functions that create and save outputs}{

These functions generate and summarize the results using alternative SURF
definitions, and save them in a hierarchical directory structure under
\code{file.path(root_dir, output_dir_name)}.

The main user function is \code{make_alt_surfs} which takes a list
of different argument combinations as input and saves the results in the
hierarchy. The input list has one element per alternative definition, each
of these being an argument list for \code{link{make_tfr_surfs}}. Note that
you do not need to explicitly vary the \code{median_only} argument in your
alternative definitions; \code{make_alt_surfs} can take this
argument and modify the alternative argument list appropriately.

\describe{

\item{\code{make_alt_surfs_output_dir_list}}{Make output directories for an
alternative SURF definition; returns a list.}

\item{\code{make_alt_surfs_filenames}}{Make filenames for an alternative
SURF variant; returns a list.}

\item{\code{make_alt_surfs}}{Calls \code{\link{make_tfr_surfs}}
for each SURF variant; returns a list of the results, named by variant IDs.}

\item{\code{make_alt_surfs_pdf_plots}}{Make and save pdf plots of surfs and
probabilities; returns the pdf filename as a string.}

\item{\code{make_alt_surfs_svg_plots}}{Make and save svg plots of surfs and
probabilities; returns the svg filenames as a list.}

\item{\code{make_alt_surfs_stats_tables}}{Make and save \file{xlsx} files with
tabulations of surfs by calling \code{\link{tabulate_surf_stats}}; returns
the filename as a string.}

\item{\code{make_alt_surfs_periods_tables}}{Make and save \file{xlsx} files with
tabulations of surfs by calling
\code{\link{make_tabulate_surf_periods_param_df}}; returns the filename as a
string.}

}}

\subsection{Functions that return objects}{

\describe{

\item{\code{make_tfr_surfs_arg_list}}{Creates a list of arguments defining an
alternative SURF definition.}

\item{\code{make_alt_surfs_variant_comparison_df}}{Make a comparison table of
multiple variants; returns a data frame.}

}}
}
\examples{

## Create list of alternative SURF definitions:
alt_SURF_defs <-
    list(default = make_tfr_surfs_arg_list(sim.dir = bayesTFR_output_dir),
         level_cond_pII_only =
           make_tfr_surfs_arg_list(sim.dir = bayesTFR_output_dir,
                               desc = "Level cond: Phase II only",
                               alt_args = list(transition_condition_type = "Phase II only")))

str(alt_SURF_defs)
}
\author{
Mark C Wheldon
}
\keyword{internal}
