% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/main_discover_surfs.R
\name{make_tfr_surfs}
\alias{make_tfr_surfs}
\title{Identify TFR surfs by country.}
\usage{
make_tfr_surfs(
  country_codes = NULL,
  sim.dir = getOption("tfrSURFs.sim.dir"),
  median_only = FALSE,
  transition_condition_type = c("Phase II & >= 2.1 persistently",
    "Phase II & never < 2.1", "Phase II only"),
  smoothing_method = c("local_linear", "annual_difference"),
  bandwidth = 3,
  rate_threshold = -0.01,
  rate_prob_threshold = 0.8,
  continuation_condition = c("Regain TFR, median, 2yr", "Regain TFR, probabilistic",
    "NONE"),
  continuation_condition_prob_threshold = 0.8,
  exceedance_condition = c("Max TFR > 2.1, median", "Max TFR > 2.1, probabilistic",
    "NONE"),
  exceedance_condition_prob_threshold = 0.8,
  min_surf_length = 2,
  min_inter_surf_length = 2,
  year_lim = c(1950, 2050),
  incl_small_countries = FALSE,
  ncores = getOption("cl.cores", -2)
)
}
\arguments{
\item{country_codes}{Vector of 3-digit numeric country code(s). Will be
coerced to numeric via \code{\link{as.numeric}}. Must be in
\code{\link{iso_all}$iso} and \code{sim.dir}.}

\item{sim.dir}{Directory with the MCMC simulation results; see
\code{\link{bayesTFR::get.tfr.mcmc}}.}

\item{median_only}{Logical; should all analysis be performed using only the
posterior medians? If \code{FALSE} (default), all trajectories are used
and the SURF analysis is probabilistic.}

\item{transition_condition_type}{Character string; key word giving the level
condition to apply.}

\item{smoothing_method}{Character string giving type of local smoothing to
use.}

\item{bandwidth}{Positive, odd integer; smoothing bandwidth.}

\item{rate_threshold}{Rate condition; any smoothed estimates of annual
change \emph{greater} than \code{rate_threshold} will be identifed as a
surf.}

\item{rate_prob_threshold}{Probability condition (a real number between 0
and 1).}

\item{continuation_condition}{Character; keyword that specifies
additional conditions required for a surf to end.}

\item{continuation_condition_prob_threshold}{Probability with which TFR must
return to level at beginning of surf; only relevant if
\code{continuation_condition} = \code{"Regain TFR, probabilistic"}.}

\item{exceedance_condition}{Only surfs where the maximum TFR is at least
\code{exceedance_crition} with probability
\code{exceedance_condition_prob_threshold} will be kept.}

\item{exceedance_condition_prob_threshold}{Probability threshold applied to
\code{exceedance_condition}.}

\item{min_surf_length}{Positive integer; minimum length (years) of any surf.}

\item{min_inter_surf_length}{Positive integer; minimum length (years) of any
inter-surf period.}

\item{year_lim}{Vector, length 2, giving the start and end years (inclusive)
defining the interval within which to limit the analysis. Stalls outside
this period will not be included.}

\item{incl_small_countries}{Logical; include countries with populations less
than 90000 in mid-2024?}

\item{ncores}{Number of cores to use to run in parallel; see
\dQuote{Details}.}
}
\value{
A data frame if \code{country_codes} has only one element, otherwise
a list, with one element per country code. See the dataset
\code{link{output_column_definitions}} for the column definitions.
}
\description{
This function will loop over all countries given by argument
\code{country_codes} (in parallel if \code{ncores} is not \code{NULL}). If
\code{country_codes} has only one element, a data frame will be returned,
otherwise a list of data frames, one for each country. If
\code{country_codes} is \code{NULL}, all countries in \code{\link{iso_all}}
will be included. A completed model run from \pkg{bayesTFR} is required. Use
\code{sim.dir} to point to the results directory on disc. If
\code{country_codes} references any countries that are not in the results
pointed to by \code{sim.dir} an error will be signalled.
}
\details{
Argument \code{ncores} controls parallelization. If \code{country_codes} has
only one element, operations will be parallelized over the MCMC trajectories
in \code{sim.dir}, otherwise over countries. If \code{ncores < 0} and
package \pkg{parallelly} is installed, \code{ncores} will be reset to
\code{parallelly::availableCores(omit = -ncores)}.

This function is based on \code{\link[FPPlateaus]{make_all_results}},
\code{\link[FPPlateaus]{make_stall_prob_df}},
\code{\link[FPPlateaus]{add_plateau_lengths}}, and
\code{\link[FPPlateaus]{add_schoumaker_tfr_stalls}}.
}
\seealso{
\code{\link{iso_all}}, the \pkg{FPPlateaus} package
(https://github.com/markalava/FPPlateaus),
\code{\link{output_column_definitions}}
}
\author{
Mark Wheldon
}
\concept{Main TFR surfs functions}
